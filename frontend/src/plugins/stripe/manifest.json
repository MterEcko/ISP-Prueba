{
  "name": "stripe",
  "version": "1.0.0",
  "description": "Plugin para procesamiento de pagos con Stripe",
  "category": "payment",
  "author": "Sistema ISP",
  "main": "src/stripe.controller.js",
  "channelType": "payment_gateway",
  "capabilities": ["process_payment", "refund", "webhook", "payment_status", "subscriptions"],
  "providers": ["stripe"],
  "countries": ["US", "CA", "MX", "BR", "AR", "CL", "CO", "PE", "UY", "GB", "EU"],
  "tables": [],
  "routes": [
    {
      "path": "/webhook/stripe",
      "method": "POST",
      "handler": "handleWebhook"
    }
  ],
  "configSchema": {
    "type": "object",
    "properties": {
      "publicKey": {
        "type": "string",
        "title": "Publishable Key",
        "description": "Clave pública de Stripe (pk_live_xxx o pk_test_xxx)",
        "pattern": "^pk_(live|test)_"
      },
      "secretKey": {
        "type": "string",
        "title": "Secret Key",
        "description": "Clave secreta de Stripe (sk_live_xxx o sk_test_xxx)",
        "format": "password",
        "pattern": "^sk_(live|test)_"
      },
      "webhookSecret": {
        "type": "string",
        "title": "Webhook Secret",
        "description": "Secreto del webhook (whsec_xxx) para verificar autenticidad",
        "format": "password",
        "pattern": "^whsec_"
      },
      "testMode": {
        "type": "boolean",
        "title": "Modo de Prueba",
        "description": "Activar modo de pruebas para desarrollo",
        "default": false
      },
      "currency": {
        "type": "string",
        "enum": ["USD", "MXN", "CAD", "BRL", "ARS", "CLP", "COP", "PEN", "UYU", "EUR", "GBP"],
        "title": "Moneda Principal",
        "description": "Moneda por defecto para los pagos",
        "default": "MXN"
      },
      "country": {
        "type": "string",
        "enum": ["US", "CA", "MX", "BR", "AR", "CL", "CO", "PE", "UY", "GB", "EU"],
        "title": "País de Operación",
        "description": "País donde opera el proveedor de servicios",
        "default": "MX"
      },
      "statementDescriptor": {
        "type": "string",
        "title": "Descriptor",
        "description": "Texto que aparece en el estado de cuenta del cliente",
        "maxLength": 22,
        "default": "ISP SISTEMA"
      },
      "captureMethod": {
        "type": "string",
        "enum": ["automatic", "manual"],
        "title": "Método de Captura",
        "description": "Captura automática o manual de pagos",
        "default": "automatic"
      },
      "notificationEmail": {
        "type": "string",
        "format": "email",
        "title": "Email de Notificaciones",
        "description": "Email para recibir notificaciones de pagos"
      }
    },
    "required": ["publicKey", "secretKey", "currency", "country"],
    "dependencies": {
      "country": {
        "oneOf": [
          {
            "properties": {
              "country": { "enum": ["US"] },
              "currency": { "enum": ["USD"] }
            }
          },
          {
            "properties": {
              "country": { "enum": ["CA"] },
              "currency": { "enum": ["CAD"] }
            }
          },
          {
            "properties": {
              "country": { "enum": ["MX"] },
              "currency": { "enum": ["MXN"] }
            }
          },
          {
            "properties": {
              "country": { "enum": ["BR"] },
              "currency": { "enum": ["BRL"] }
            }
          },
          {
            "properties": {
              "country": { "enum": ["GB"] },
              "currency": { "enum": ["GBP"] }
            }
          },
          {
            "properties": {
              "country": { "enum": ["EU"] },
              "currency": { "enum": ["EUR"] }
            }
          }
        ]
      }
    }
  },
  "permissions": [
    "process_payments",
    "manage_refunds",
    "view_payment_statistics",
    "manage_billing",
    "manage_subscriptions"
  ],
  "webhookSupport": {
    "stripe": {
      "events": [
        "payment_intent.succeeded",
        "payment_intent.payment_failed",
        "charge.refunded",
        "customer.subscription.created",
        "customer.subscription.updated",
        "customer.subscription.deleted",
        "invoice.payment_succeeded",
        "invoice.payment_failed"
      ],
      "signatureHeader": "stripe-signature",
      "verificationMethod": "stripe_signature"
    }
  },
  "paymentMethods": {
    "MX": [
      {
        "id": "card",
        "name": "Tarjeta de Crédito/Débito",
        "types": ["visa", "mastercard", "amex"],
        "processingTime": "immediate"
      },
      {
        "id": "oxxo",
        "name": "OXXO",
        "types": ["oxxo"],
        "processingTime": "1-3_business_days"
      },
      {
        "id": "spei",
        "name": "Transferencia SPEI",
        "types": ["spei"],
        "processingTime": "immediate"
      }
    ],
    "US": [
      {
        "id": "card",
        "name": "Credit/Debit Card",
        "types": ["visa", "mastercard", "amex", "discover"],
        "processingTime": "immediate"
      },
      {
        "id": "us_bank_account",
        "name": "ACH Direct Debit",
        "types": ["ach"],
        "processingTime": "5-7_business_days"
      }
    ],
    "BR": [
      {
        "id": "card",
        "name": "Cartão de Crédito/Débito",
        "types": ["visa", "mastercard"],
        "processingTime": "immediate"
      },
      {
        "id": "boleto",
        "name": "Boleto Bancário",
        "types": ["boleto"],
        "processingTime": "1-3_business_days"
      }
    ]
  },
  "fees": {
    "description": "Tarifas varían por país y método de pago",
    "details": "https://stripe.com/pricing"
  },
  "supportedCurrencies": ["USD", "MXN", "CAD", "BRL", "ARS", "CLP", "COP", "PEN", "UYU", "EUR", "GBP"],
  "minimumVersions": {
    "node": "14.0.0",
    "stripe": "10.0.0"
  }
}
